<link rel="stylesheet" type="text/css" href="css/home.css">
<% if(locals.user) { %>
<div id="posts-form-container">
    <form id="post-submit-form" action="/posts/create" method="post">
        <textarea name="content" id="post-content" placeholder="Enter Text" cols="30" rows="3"></textarea>
        <button type="submit">Post</button>
    </form>
</div> 

<% } %>

<div id="posts-container">
    <ul id="posts">
        <% for(let post of posts) { %>
            <li>
                <p><%= post.user.name %></p>
                <p><%= post.content %></p>
                <% let postId = post.id %>
                <% if(locals.user && post.user.id == locals.user.id) { %>
                <a href="posts/delete?postId=<%=postId%>">Delete Post</a>
                <%}%>
                <% if(locals.user) { %> 
                <form id="comment" action="/posts/comments/create" method="POST">
                    <textarea name="comment" id="comment-id" cols="30" rows="2"></textarea>
                    <input type="hidden" name="postId" value=<%= post._id %>>
                    <button type="submit">Comment</button>
                </form>
                <% } %>
                <div id="show-comments-container">
                    <ul>
                        <li>
                           <% for(let comment of post.comments) { %> 
                                <p> Comment done by: <%= comment.user.name %></p>
                                <p> <%= comment.content %></p>
                                <% if(locals.user && (comment.user.id == locals.user.id || post.user.id == locals.user.id)){ %>
                                <a href="posts/comments/delete/<%= comment.id %>">Delete Comment</a>
                                <% } %>
                            <% } %>
                        </li>
                    </ul>
                </div>
            </li>
        <% } %>
    </ul>
    
</div>